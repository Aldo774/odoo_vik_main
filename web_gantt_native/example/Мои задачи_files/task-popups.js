(function(t){if(BX.TaskPriorityPopup)return;var e=function(t,e,s,p,o){this.items=[];this.popupId=t;this.popupClassName=e;if(BX.type.isArray(p)){for(var i=0;i<p.length;i++){if(typeof p[i]["id"]!=="undefined")this.items.push(p[i])}}this.params=o||{};this.title=s;this.popupWindow=null;this.currentTask=null;this.tasksData={};this.itemList=[]};e.prototype.show=function(t,e,s,p){if(this.popupWindow!==null)this.popupWindow.close();this.currentTask=this.__getTask(t,e,s,p);if(this.currentTask===null)return false;if(this.popupWindow==null)this.__createLayout();else this.popupWindow.setBindElement(this.currentTask.bindElement);this.__redrawList();this.popupWindow.show()};e.prototype.__createLayout=function(){var t=[];for(var e=0;e<this.items.length;e++){var s=this.items[e];var p=BX.create("a",{props:{className:"task-popup-list-item"},events:{click:BX.proxy(this.__onItemClick,{obj:this,listItem:s})},children:[BX.create("span",{props:{className:"task-popup-list-item-left"}}),BX.create("span",{props:{className:"task-popup-list-item-icon task-popup-"+this.popupClassName+"-icon-"+s.className}}),BX.create("span",{props:{className:"task-popup-list-item-text"},text:s.name}),BX.create("span",{props:{className:"task-popup-list-item-right"}})]});this.itemList[s.id]=p;t.push(p)}this.popupWindow=BX.PopupWindowManager.create("bx-task-"+this.popupId+"-popup",this.currentTask.bindElement,{autoHide:true,offsetTop:1,lightShadow:true,events:{onPopupClose:BX.proxy(this.__onPopupClose,this)},content:this.popupWindowContent=BX.create("div",{props:{className:"task-"+this.popupClassName+"-popup"},children:[BX.create("div",{props:{className:"task-"+this.popupClassName+"-popup-title"},text:this.title}),BX.create("div",{props:{className:"popup-window-hr"},children:[BX.create("i",{})]}),BX.create("div",{props:{className:"task-popup-list-list"},children:t})]})})};e.prototype.__redrawList=function(){this.__selectItem(this.currentTask.listValue)};e.prototype.__selectItem=function(t){for(var e in this.itemList){var s=this.itemList[e];if(t==e)BX.addClass(s,"task-popup-list-item-selected");else BX.removeClass(s,"task-popup-list-item-selected")}};e.prototype.__getTask=function(t,e,s,p){if(!BX.type.isNumber(t))return null;if(!this.tasksData[t]){this.tasksData[t]={id:t,bindElement:e,listItem:{},onPopupChange:p.events&&p.events.onPopupChange&&BX.type.isFunction(p.events.onPopupChange)?p.events.onPopupChange:null,onPopupClose:p.events&&p.events.onPopupClose&&BX.type.isFunction(p.events.onPopupClose)?p.events.onPopupClose:null};if(typeof s=="object")for(var o in s)this.tasksData[t][o]=s[o];else this.tasksData[t].listValue=s;if(typeof this.tasksData[t]["listValue"]!=="undefined"){for(var i=0;i<this.items.length;i++){if(this.items[i].id===this.tasksData[t].listValue){this.tasksData[t].listItem=this.items[i];break}}}}return this.tasksData[t]};e.prototype.__onItemClick=function(t){this.obj.popupWindow.close();if(this.obj.currentTask.listValue!=this.listItem.id){this.obj.currentTask.listValue=this.listItem.id;this.obj.currentTask.listItem=this.listItem;if(this.obj.currentTask.onPopupChange)this.obj.currentTask.onPopupChange()}BX.PreventDefault(t)};e.prototype.__onPopupClose=function(t){if(this.currentTask.onPopupClose)this.currentTask.onPopupClose()};var s=function(){s.superclass.constructor.apply(this,["priority","priority",BX.message("TASKS_PRIORITY"),[{id:0,name:BX.message("TASKS_PRIORITY_LOW"),className:"low"},{id:1,name:BX.message("TASKS_PRIORITY_MIDDLE"),className:"middle"},{id:2,name:BX.message("TASKS_PRIORITY_HIGH"),className:"high"}],{}])};BX.extend(s,e);BX.TaskPriorityPopup={popup:null,show:function(t,e,p,o){if(this.popup==null)this.popup=new s;this.popup.show(t,e,p,o)}};var p=function(t){p.superclass.constructor.apply(this,[t,"grade",BX.message("TASKS_MARK"),[{id:"NULL",name:BX.message("TASKS_MARK_NONE"),className:"none"},{id:"P",name:BX.message("TASKS_MARK_POSITIVE"),className:"plus"},{id:"N",name:BX.message("TASKS_MARK_NEGATIVE"),className:"minus"}],{}])};BX.extend(p,e);var o=function(t){o.superclass.constructor.apply(this,arguments);this.reportCheckbox=null;this.selectedItem=null};BX.extend(o,p);o.prototype.__createLayout=function(){o.superclass.__createLayout.apply(this,[]);this.popupWindowContent.appendChild(BX.create("div",{props:{className:"popup-window-hr"},children:[BX.create("i",{})]}));this.popupWindowContent.appendChild(BX.create("div",{props:{className:"task-popup-list-report"},children:[BX.create("form",{props:{className:"task-popup-list-report-form"},children:[BX.create("label",{props:{forHtml:"task-grade-popup-report"},children:[this.reportCheckbox=BX.create("input",{props:{type:"checkbox",id:"task-grade-popup-report"}}),BX.create("span",{text:BX.message("TASKS_ADD_IN_REPORT")})]})]})]}));this.popupWindow.setButtons([new BX.PopupWindowButton({text:BX.message("TASKS_APPLY"),className:"popup-window-button-create",events:{click:BX.proxy(this.__onButtonClick,this)}})])};o.prototype.__redrawList=function(){o.superclass.__redrawList.apply(this,[]);this.__setTaskReport(this.currentTask.report);this.selectedItem=null};o.prototype.__setTaskReport=function(t){this.reportCheckbox.checked=!!t};o.prototype.__onItemClick=function(){this.obj.selectedItem=this.listItem;this.obj.__selectItem(this.listItem.id)};o.prototype.__onButtonClick=function(){this.popupWindow.close();if(this.reportCheckbox.checked!=this.currentTask.report||this.selectedItem!=null&&this.selectedItem.id!=this.currentTask.listValue){this.currentTask.report=this.reportCheckbox.checked;if(this.selectedItem!=null){this.currentTask.listValue=this.selectedItem.id;this.currentTask.listItem=this.selectedItem}if(this.currentTask.onPopupChange)this.currentTask.onPopupChange()}};BX.TaskGradePopup={simplePopup:null,popup:null,show:function(t,e,s,i){if(typeof s!="object"||typeof s["report"]=="undefined"){if(this.simplePopup==null)this.simplePopup=new p("grade-simple");this.simplePopup.show(t,e,s,i)}else{if(this.popup==null)this.popup=new o("grade");this.popup.show(t,e,s,i)}}};BX.TaskSpentHoursPopup={popup:null,bindElement:null,hoursTextbox:null,currentValue:0,params:{},show:function(t,e,s){this.params=s||{};if(this.popup===null)this.__init(t,e);this.popup.show()},__init:function(t,e){if(this.params.events){for(var s in this.params.events)BX.addCustomEvent(this,s,this.params.events[s])}var p=parseInt(e);this.currentValue=isNaN(p)?0:p;this.popup=BX.PopupWindowManager.create("task-spent-hours-popup",t,{content:BX.create("div",{props:{className:"task-detail-spent-hours-popup"},children:[BX.create("span",{props:{className:"task-detail-spent-hours-label"},text:BX.message("TASKS_DURATION")+":"}),this.hoursTextbox=BX.create("input",{props:{type:"text",className:"task-detail-spent-hours-textbox",value:this.currentValue},attrs:{autocomplete:"off"},events:{keyup:BX.proxy(this.__onKeyupTextbox,this)}})]}),buttons:[new BX.PopupWindowButton({text:BX.message("TASKS_OK"),className:"popup-window-button-create",events:{click:BX.proxy(this.__onOkButtonClick,this)}}),new BX.PopupWindowButtonLink({text:BX.message("TASKS_CANCEL"),className:"popup-window-button-link-cancel",events:{click:BX.proxy(this.__onCancelButtonClick,this)}})],offsetLeft:-70,events:{onAfterPopupShow:BX.proxy(this.__onAfterPopupShow,this),onPopupClose:BX.proxy(this.__onPopupClose,this)}})},__onOkButtonClick:function(t){this.__applyChanges();this.popup.close();BX.PreventDefault(t)},__applyChanges:function(){var t=parseInt(this.hoursTextbox.value);if(!isNaN(t)&&t!=this.currentValue){this.currentValue=t;BX.onCustomEvent(this,"onPopupChange",[this])}else this.hoursTextbox.value=this.currentValue},__onCancelButtonClick:function(t){this.hoursTextbox.value=this.currentValue;this.popup.close();BX.PreventDefault(t)},__onAfterPopupShow:function(){BX.focus(this.hoursTextbox);this.hoursTextbox.select()},__onPopupClose:function(){BX.onCustomEvent(this,"onPopupClose",[this])},__onKeyupTextbox:function(e){e=e||t.event;var s=e.keyCode?e.keyCode:e.which?e.which:null;if(s==13){this.__applyChanges();this.popup.close()}}};BX.TaskDeclinePopup={popup:null,textarea:null,params:{},show:function(t,e){this.params=e||{};if(this.popup===null)this.popup=this.__init(t);this.textarea.value="";this.popup.show();BX.focus(this.textarea)},__init:function(t){return BX.PopupWindowManager.create("task-decline-popup",t,{offsetLeft:this.params.offsetLeft&&BX.type.isNumber(this.params.offsetLeft)?this.params.offsetLeft:0,offsetTop:this.params.offsetTop&&BX.type.isNumber(this.params.offsetTop)?this.params.offsetTop:0,buttons:[new BX.PopupWindowButton({text:BX.message("TASKS_DECLINE"),className:"popup-window-button-decline",events:{click:BX.proxy(this.__onOkButtonClick,this)}}),new BX.PopupWindowButtonLink({text:BX.message("TASKS_CANCEL"),className:"popup-window-button-link-cancel",events:{click:BX.proxy(this.__onCancelButtonClick,this)}})],content:BX.create("div",{props:{className:"task-decline-popup"},children:[BX.create("div",{props:{className:"task-decline-popup-title"},text:BX.message("TASKS_DECLINE_REASON")}),BX.create("div",{props:{className:"task-decline-popup-reason"},children:[this.textarea=BX.create("textarea",{props:{className:"task-decline-popup-reason-textarea"}})]})]})})},__onOkButtonClick:function(){if(this.params.events&&this.params.events.onPopupChange&&BX.type.isFunction(this.params.events.onPopupChange))BX.proxy(this.params.events.onPopupChange,this)();this.__onClosePopup()},__onCancelButtonClick:function(t){this.__onClosePopup();BX.PreventDefault(t)},__onClosePopup:function(){if(this.params.events&&this.params.events.onPopupClose&&BX.type.isFunction(this.params.events.onPopupClose))BX.proxy(this.params.events.onPopupClose,this)();this.popup.close()}}})(window);
//# sourceMappingURL=task-popups.map.js